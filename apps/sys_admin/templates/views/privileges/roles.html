<div title="List of roles" class="tile">
    <div class="row">
    	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    		<div class="btn-toolbar pull-left" role="toolbar" aria-label="">
        <div class="btn-group" role="group" aria-label="">
            <span class="label">${get_app_res("Select schema")}</span> &nbsp;
        </div>
        <div class="btn-group" role="group" aria-label="">
            <select  class="form-control" ng-change="doSelectSchema()" ng-model="selectedSchema">
                <option value="" ng-repeat="p in listOfSchema" ng-value="p.schema">{{p.schema}}</option>
            </select>
        </div>
    </div>
    <div class="btn-toolbar pull-right" role="toolbar">
        <div class="btn-group">
            <button type="button" class="btn btn-primary" ng-click="$root.$dialog($id).ok(doLoadData).url(dialog_editor).done()">${get_app_res("Add new")}</button>
        </div>

    </div>
    	</div>
    </div>
    <div class="row">
    	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    		&nbsp;
    	</div>
    </div>
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<table class="table table-bordered table-hover">
    	<thead>
    		<tr>
    			<th>
                    ${get_app_res("Code")}
                </th>
                <th>
                    ${get_app_res("Name")}
                </th>
                <th>
                    ${get_app_res("Schema")}
                </th>
                <th>
                    ${get_app_res("Total apps")}
                </th>
                <th>
                    ${get_app_res("Description")}
                </th>
                <th></th>
    		</tr>
    	</thead>
    	<tbody>
    		<tr ng-repeat="p in data.items">
    			<td>{{p.Code}}</td>
                <td>{{p.Name}}</td>
                <td>{{p.Schema}}</td>
                <td>
                    <a href="#{{$root.url().param('page','pages/privileges/apps').param('role',p.Code).param('schema',p.Schema).url()}}">
                        {{p.TotalApps}}
                    </a>

                </td>
                <td>{{p.Description}}</td>
                <td>
                    <button type="button" class="btn btn-primary" ng-click="$root.$dialog($id).params(p).url(dialog_list_views).done()">
                        ${get_app_res("Add app")}
                    </button>

                </td>
    		</tr>
    	</tbody>
    </table>
	</div>
</div>


</div>
<script>
    (function(scope){

        scope.selectedSchema=null;
        scope.dialog_editor='${get_app_url("dialogs/privileges/role_edit")}';
        scope.dialog_list_views='${get_app_url("dialogs/privileges/role_edit_views_list")}';
        scope.page_list_apps='${get_app_url("dialogs/privileges/apps")}';
        scope.doLoadData=function(){
            scope.$ws.api('${get_api_key("api.privileges/get_list_of_roles")}').done()
            .then(function(res){
                scope.data=res;
                scope.$applyAsync();
            });
        };
        scope.doLoadData();
        scope.doLoadSchema=function(){
            scope.$ws.api('${get_api_key("api.privileges/get_list_of_schema")}')
            .done()
            .then(function(res){
                scope.listOfSchema=res;
                scope.$applyAsync();
            });
        };
        scope.doLoadSchema();



        scope.doSelectSchema=function(){
            $url().param("schema",scope.selectedSchema).apply();

        }
        scope.$root.$history.onChange(scope,function(data){


            if(data.schema){
                scope.$ws.api('${get_api_key("api.privileges/get_list_of_roles")}')
                .data({schema:data.schema})
                .done()
                .then(function(res){
                    scope.data=res;
                    scope.$applyAsync();
                });
            }
            else {
                scope.$ws.api('${get_api_key("api.privileges/get_list_of_roles")}').done()
                .then(function(res){
                    scope.data=res;
                    scope.$applyAsync();
                });
            }

        });

        

        console.log(scope.$ws);
    });
</script>