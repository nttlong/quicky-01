<%page cached="True"/>

<%
    from quicky import encryptor

%>
<%
    import json
    self.cols=[
            {"title": request.get_app_res("Code"), "field": "code"},
            {"title": request.get_app_res("Name"), "field": "name"},
            {"title": request.get_app_res("Description"), "field": "description"},
            {"title": request.get_app_res("Created on"), "field": "created_on","type":"date"},
            {"title": request.get_app_res("Created by"), "field": "created_by"},
            {"title": request.get_app_res("Modified on"), "field": "modified_on","type":"date"},
            {"title": request.get_app_res("Modified by"), "field": "modified_by"}

        ]


%>

<script>
    (function(s){
        _cols = ${json.dumps(self.cols)};
        s.columns=[];
        for(var i=0;i<_cols.length;i++){
            s.columns.push(agGridColumn(
                s,
                _cols[i].title,
                _cols[i].field

            ))
        }

    });
</script>
${self.body()}
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        
        <div class="btn-toolbar pull-right" role="toolbar">
            <div class="btn-group">

            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-default" ng-click="$root.$dialog($id).params({source:source}).url(url_import_dialog).done()">${get_app_res("Import")}</button>

            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-default" ng-click="$root.$dialog($id).params({source:source}).url(url_export_dialog).done()">${get_app_res("Export")}</button>

            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-default" ng-click="$root.$dialog($id).params({source:source}).url(url_editor_dialog).done()">${get_app_res("New")}</button>
            </div>
        </div>
	</div>
</div>
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		&nbsp;
	</div>
</div>
<div class="row">
    <div b-ag-grid columns="{{columns}}" id="agGrid" on-load-data="doLoadData"></div>
<!--<div ag-grid="gridOptions" class="ag-theme-fresh" style="height: 100%;"></div> -->
</div>


<script>
    (function(s){
        s.url_editor_dialog='${get_app_url("dialogs/dialogs/"+model["path"].split('/')[1])}';
        s.url_export_dialog='${get_app_url("dialogs/exports/download_excel")}';
        s.url_import_dialog='${get_app_url("dialogs/imports/upload_excel")}';
        s.source='${encryptor.get_key(model["path"].split('/')[1])}';
        s.doLoadData=function(sender){
            s.$ws.api('${get_api_key("api.categories/get_list")}')
            .data({
                source:s.source,
                params:sender.params
            }).done()
            .then(function(res){
                sender.done(res);
            });
        };

        s.doAddNew=function(item,callback){
            s.$ws.api('${get_api_key("api.categories/add_new_item")}')
            .data({
                source:s.source,
                item:item
            }).done()
            .then(function(res){

                s.doLoadData();
            });
        };
        s.doUpdate=function(item){
            s.$ws.api('${get_api_key("api.categories/update_item")}')
            .data({
                source:s.source,
                item:item
            }).done()
            .then(function(res){
                debugger;
                s.doLoadData();
            });
        };
        setTimeout(function(){
            $("#agGrid").css({
                height:$(window).height()-250
            });
        },200);
       
        $(window).resize(function(){
            $("#agGrid").css({
                height:$(window).height()-250
            })
        });
    });
</script>